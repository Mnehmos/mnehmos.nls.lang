# Tutorial: Your First Module

Build a complete calculator module from scratch and learn the fundamentals of NLS.

## What You'll Learn

- Creating an NLS project
- Writing your first ANLU
- Compiling to Python
- Running tests
- Understanding the lockfile

## Prerequisites

- Python 3.11+
- `nlsc` installed (`pip install nlsc`)

---

## Step 1: Create a Project

Open your terminal and create a new NLS project:

```bash
nlsc init calculator-project
cd calculator-project
```

This creates:

```
calculator-project/
├── nl.config.yaml    # Project configuration
├── src/              # Your .nl source files
│   └── __init__.py
└── tests/            # Generated tests go here
    └── __init__.py
```

---

## Step 2: Write Your First ANLU

Create `src/calculator.nl`:

```nl
@module calculator
@target python

[add]
PURPOSE: Add two numbers together
INPUTS:
  - a: number
  - b: number
RETURNS: a + b
```

Let's break this down:

| Line | Meaning |
|------|---------|
| `@module calculator` | Names the module (becomes the Python module name) |
| `@target python` | Tells the compiler to generate Python |
| `[add]` | Defines an ANLU named "add" |
| `PURPOSE:` | Describes what the function does (becomes the docstring) |
| `INPUTS:` | Lists the parameters with types |
| `RETURNS:` | The return expression |

---

## Step 3: Compile to Python

```bash
nlsc compile src/calculator.nl
```

Output:

```
Compiling src/calculator.nl (parser: regex)...
  ✓ Parsed 1 ANLUs
  ✓ Resolved dependencies
  ✓ Generated calculator.py (12 lines)
  ✓ Updated calculator.nl.lock

Compilation complete!
```

Look at the generated `src/calculator.py`:

```python
"""
Generated by nlsc
Module: calculator
"""

def add(a: float, b: float) -> float:
    """Add two numbers together."""
    return a + b
```

Notice how NLS automatically:
- Created type hints (`float` for `number`)
- Generated a docstring from PURPOSE
- Created the return statement

---

## Step 4: Add More Functions

Expand `src/calculator.nl`:

```nl
@module calculator
@target python

[add]
PURPOSE: Add two numbers together
INPUTS:
  - a: number
  - b: number
RETURNS: a + b

[subtract]
PURPOSE: Subtract second number from first
INPUTS:
  - a: number
  - b: number
RETURNS: a - b

[multiply]
PURPOSE: Multiply two numbers
INPUTS:
  - a: number
  - b: number
RETURNS: a * b

[divide]
PURPOSE: Divide first number by second safely
INPUTS:
  - numerator: number
  - divisor: number
GUARDS:
  - divisor must not be zero -> ValueError("Cannot divide by zero")
RETURNS: numerator / divisor
```

The `[divide]` function introduces **GUARDS** — preconditions that are checked before the function runs.

Recompile:

```bash
nlsc compile src/calculator.nl
```

---

## Step 5: Add Tests

Add test blocks to your `.nl` file:

```nl
@module calculator
@target python

[add]
PURPOSE: Add two numbers together
INPUTS:
  - a: number
  - b: number
RETURNS: a + b

[subtract]
PURPOSE: Subtract second number from first
INPUTS:
  - a: number
  - b: number
RETURNS: a - b

[multiply]
PURPOSE: Multiply two numbers
INPUTS:
  - a: number
  - b: number
RETURNS: a * b

[divide]
PURPOSE: Divide first number by second safely
INPUTS:
  - numerator: number
  - divisor: number
GUARDS:
  - divisor must not be zero -> ValueError("Cannot divide by zero")
RETURNS: numerator / divisor

@test [add] {
  add(2, 3) == 5
  add(-1, 1) == 0
  add(0, 0) == 0
}

@test [multiply] {
  multiply(3, 4) == 12
  multiply(0, 100) == 0
  multiply(-2, 3) == -6
}

@test [divide] {
  divide(10, 2) == 5.0
  divide(9, 3) == 3.0
}
```

Run the tests:

```bash
nlsc test src/calculator.nl
```

Output:

```
Running 8 test cases from src/calculator.nl...
  • [add]: 3 cases
  • [multiply]: 3 cases
  • [divide]: 2 cases

✓ All 8 tests passed!
```

---

## Step 6: Understand the Lockfile

After compilation, check `src/calculator.nl.lock`:

```yaml
# DO NOT EDIT - Generated by nlsc
schema_version: 1
generated_at: 2025-01-15T10:30:00Z
compiler_version: 0.4.0
llm_backend: mock

modules:
  calculator:
    source_hash: sha256:a1b2c3...
    anlus:
      add:
        source_hash: sha256:abc123...
        output_hash: sha256:def456...
        output_lines: 4
        generated_code: |
          def add(a: float, b: float) -> float:
              """Add two numbers together."""
              return a + b
```

The lockfile:

- **Tracks changes** — `nlsc diff` shows what changed
- **Enables reproducibility** — Same source = same output
- **Caches generated code** — For zero-LLM rebuilds

---

## Step 7: Use Your Module

Create a Python file that uses your calculator:

```python
# demo.py
from src.calculator import add, subtract, multiply, divide

print(f"2 + 3 = {add(2, 3)}")
print(f"10 - 4 = {subtract(10, 4)}")
print(f"5 × 6 = {multiply(5, 6)}")
print(f"15 ÷ 3 = {divide(15, 3)}")

# This will raise ValueError:
try:
    divide(1, 0)
except ValueError as e:
    print(f"Error: {e}")
```

Run it:

```bash
python demo.py
```

Output:

```
2 + 3 = 5
10 - 4 = 6
5 × 6 = 30
15 ÷ 3 = 5.0
Error: Cannot divide by zero
```

---

## What You've Learned

- [x] Creating NLS projects with `nlsc init`
- [x] Writing ANLUs with PURPOSE, INPUTS, RETURNS
- [x] Using GUARDS for validation
- [x] Writing `@test` blocks
- [x] Compiling and testing with `nlsc compile` and `nlsc test`
- [x] Understanding lockfiles

---

## Exercises

1. **Add a `power` function** — Calculate `base` raised to `exponent`
2. **Add a `modulo` function** — Return remainder with guard for zero divisor
3. **Add a `negate` function** — Return the negative of a number (single input)
4. **Write tests** for all new functions

??? example "Solution"
    ```nl
    [power]
    PURPOSE: Calculate base raised to exponent
    INPUTS:
      - base: number
      - exponent: number
    RETURNS: base ** exponent

    [modulo]
    PURPOSE: Return remainder of division
    INPUTS:
      - dividend: number
      - divisor: number
    GUARDS:
      - divisor must not be zero -> ValueError("Cannot divide by zero")
    RETURNS: dividend % divisor

    [negate]
    PURPOSE: Return the negative of a number
    INPUTS:
      - x: number
    RETURNS: -x

    @test [power] {
      power(2, 3) == 8
      power(10, 0) == 1
    }

    @test [modulo] {
      modulo(10, 3) == 1
      modulo(15, 5) == 0
    }

    @test [negate] {
      negate(5) == -5
      negate(-3) == 3
    }
    ```

---

## Next Steps

- **[Working with Types](working-with-types.md)** — Define custom types and use constraints
- **[CLI Reference](../cli-reference.md)** — Learn all `nlsc` commands
- **[Language Specification](../language-spec.md)** — Complete syntax reference
